<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SessionStorage and Google Drive</title>
    <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
    <h1>SessionStorage and Google Drive Example</h1>
    <button onclick="saveArrayToSession()">Save Array in SessionStorage</button>
    <button onclick="retrieveArrayFromSession()">Retrieve Array from SessionStorage</button>
    <button onclick="saveToGoogleDrive()">Save on Google Drive</button>
    <button onclick="getFromGoogleDrive()">Get from Google Drive</button>
    <p id="output"></p>

    <script>
        function saveArrayToSession() {
            const array = Array.from({ length: 10 }, () => Math.floor(Math.random() * 100));
            sessionStorage.setItem('randomArray', JSON.stringify(array));
            alert('Array saved in SessionStorage.');
        }

        function retrieveArrayFromSession() {
            const array = JSON.parse(sessionStorage.getItem('randomArray'));
            document.getElementById('output').innerText = 'SessionStorage Array: ' + array;
        }

        function saveToGoogleDrive() {
            const authInstance = gapi.auth2.getAuthInstance();
            if (!authInstance.isSignedIn.get()) {
                authInstance.signIn().then(() => {
                    saveFile();
                }).catch((error) => {
                    alert('Failed to sign in: ' + error.error);
                });
            } else {
                saveFile();
            }
        }

        function saveFile() {
            const array = sessionStorage.getItem('randomArray');
            const fileContent = array;
            const file = new Blob([fileContent], { type: 'text/plain' });
            const metadata = {
                'name': 'randomArray.txt',
                'mimeType': 'text/plain'
            };

            const accessToken = gapi.auth.getToken().access_token;
            const form = new FormData();
            form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
            form.append('file', file);

            fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id', {
                method: 'POST',
                headers: new Headers({ 'Authorization': 'Bearer ' + accessToken }),
                body: form
            }).then((res) => res.json()).then((val) => {
                console.log(val);
                localStorage.setItem('fileId', val.id);
                alert('File saved to Google Drive with ID: ' + val.id);
            }).catch((error) => {
                alert('Error saving file: ' + error);
            });
        }

        function getFromGoogleDrive() {
            const fileId = localStorage.getItem('fileId');
            if (!fileId) {
                alert('No file ID found. Save a file to Google Drive first.');
                return;
            }
            const accessToken = gapi.auth.getToken().access_token;
            
            fetch(`https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`, {
                method: 'GET',
                headers: new Headers({ 'Authorization': 'Bearer ' + accessToken })
            }).then(response => response.text()).then((data) => {
                localStorage.setItem('retrievedArray', data);
                document.getElementById('output').innerText = 'Retrieved from Drive: ' + data;
            }).catch((error) => {
                alert('Error retrieving file: ' + error);
            });
        }

        function loadClient() {
            gapi.load('client:auth2', initClient);
        }

        function initClient() {
            gapi.client.init({
                apiKey: 'AIzaSyAbf0IPLaP6Cbbx3NnFlfzcWQ-zxIc5S8E', // Replace with my actual API key
                clientId: '371617464258-ntrqn44lfo1lpi294hmc5ebad5b9ok5a.apps.googleusercontent.com', // Replace with my actual client ID
                discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],
                scope: 'https://www.googleapis.com/auth/drive.file'
            }).then(() => {
                gapi.auth2.getAuthInstance();
            }).catch((error) => {
                alert('Error initializing Google API client: ' + error);
            });
        }

        loadClient();
    </script>
</body>
</html>
