<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Form</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Icons+Outlined" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/easymde/dist/easymde.min.css">
<script src="https://unpkg.com/easymde/dist/easymde.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      display: flex; 
      min-height: 100vh; 
      flex-direction: column;
    }
main { flex: 1 0 auto; }

input {
  padding-right: 30px; /* Space for the clear button */
  font-size: 16px;
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 4px;
  outline: none;
}

input:focus {
  border-color: #007bff;
  box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
}

.clear-btn {
position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  cursor: pointer;
  font-size: 18px;
  color: #999;
  padding: 0;
  line-height: 1;
}


.clear-btn:hover {
  color: #333;
}

        #icon-select { cursor: pointer; background: none; border: none; padding: 0; display: flex; align-items: center; justify-content: center; width: 56px; height: 56px; transition: background-color 0.3s; }
        #icon-select:hover, #icon-select:focus { background-color: rgba(0, 0, 0, 0.1); }
        #search { flex-grow: 1; height: 56px; font-size: 16px; border: none; outline: none; margin-left: 10px; padding: 0 15px; }
        #icon-name { margin: 0 15px 0 0; font-size: 1rem; }
        #color-select { display: flex; align-items: center; justify-content: center; width: 56px; height: 56px; font-size: 12px; font-weight: bold; color: white; text-shadow: 0 0 3px rgba(0, 0, 0, 0.5); cursor: pointer; }
        .card-panel { position: relative; z-index: 1; display: flex; flex-direction: column; align-items: stretch; padding: 0; }
        #icon-select .material-icons-outlined { font-size: 32px; }
        #icon-dropdown {
            display: none;
            position: absolute;
            z-index: 1000;
            background-color: white;
            border-radius: 4px;
            box-shadow: 0 8px 17px 2px rgba(0,0,0,0.14), 0 3px 14px 2px rgba(0,0,0,0.12), 0 5px 5px -3px rgba(0,0,0,0.2);
            top: calc(100% + 10px);
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 400px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
        }
        #icon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(48px, 1fr));
            gap: 10px;
        }
        .icon { text-align: center; cursor: pointer; padding: 10px; border-radius: 4px; transition: background-color 0.3s; }
        .icon:hover { background-color: #f0f0f0; }
        .material-icons-outlined { font-size: 24px; }
        @media only screen and (min-width: 601px) {
            .container { width: 85%; }
        }
    .container {
      max-width: 500px;
      margin: 0 auto;
    }

    .input-field {
      margin-bottom: 20px;
      position: relative;
  
    }

    .input-field input[type="url"],
    .input-field input[type="text"],
    .input-field input[type="tel"],
    .input-field select,
    .input-field textarea {
      display: block;
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    .icon-source-selector {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .icon-source-selector select {
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
      background-color: white;
      appearance: auto;
    }

    .button-container {
      display: flex;
      gap: 20px;
      justify-content: center;
    }

    .button-container button {
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #18488e;
      color: white;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 24px;
      overflow: hidden;
      position: relative;
      border: none;
      cursor: pointer;
    }

    .button-container button i {
      font-size: 36px;
    }

    .button-container button::before {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: 200%;
      height: 200%;
      background-color: rgba(255, 255, 255, 0.4);
      border-radius: 50%;
      transform: translate(-50%, -50%) scale(0);
      transition: transform 0.4s;
    }

    .button-container button:active::before {
      transform: translate(-50%, -50%) scale(1);
      transition: 0s;
    }

    .error {
      color: red;
      font-size: 0.8rem;
      margin-top: 5px;
    }
  </style>
</head>
<body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<script src="https://unpkg.com/showdown/dist/showdown.min.js"></script>
<script>
let linkTypeSelect;
let iconSourceSelect;

document.addEventListener('DOMContentLoaded', function() {
    linkTypeSelect = document.getElementById('link-type');
    iconSourceSelect = document.getElementById('icon-source');
    const additionalFields = document.getElementById('additional-fields');
    const iconSourceContainer = document.getElementById('icon-source-container');
    const noteField = document.getElementById('note-field');
    const introField = document.getElementById('intro-field');
    const urlField = document.getElementById('url-field');
    const phoneNumberField = document.getElementById('phone-number-field');
    const easyMDE = new EasyMDE({
    element: document.getElementById('intro-content'),
    autoDownloadFontAwesome: true,
    scrollbarStyle: null,
    promptURLs: true,
    toolbar: [
      "bold", "italic", "heading", "|",
      "unordered-list", "table", "horizontal-rule", "|",
      "link", "image", "preview"
    ],
    placeholder: "Write your post here... (max 1000 characters)",
    maxLength: 1000
  });
  var urlInput = document.getElementById('new-link-url');
  var uclearBtn = document.getElementById('u-clear-btn');
  var textInput = document.getElementById('new-link-name');
  var tclearBtn = document.getElementById('t-clear-btn');

    
  
    urlInput.addEventListener('input', function() {
    uclearBtn.style.display = this.value ? 'block' : 'none';
  });
  
    textInput.addEventListener('input', function() {
    tclearBtn.style.display = this.value ? 'block' : 'none';
  });

  tclearBtn.addEventListener('click', function() {
    textInput.value = '';
    this.style.display = 'none';
    textInput.focus();
  });
  
    uclearBtn.addEventListener('click', function() {
    urlInput.value = '';
    this.style.display = 'none';
    urlInput.focus();
  });

    
  
    function handleLinkTypeChange() {
        const linkType = linkTypeSelect.value;
        console.log(`Link type changed to: ${linkType}`);  // Debug log
        clearForm();
        showFields(linkType);
    }

    function handleIconSourceChange() {
        const iconSource = iconSourceSelect.value;
        console.log(`Icon source changed to: ${iconSource}`);  // Debug log
        document.getElementById('new-icon-url').style.display = 'none';
        document.getElementById('new-link-icon').style.display = 'none';
        if (iconSource === 'link') {
            document.getElementById('new-icon-url').style.display = 'block';
        } else if (iconSource === 'file') {
            document.getElementById('new-link-icon').style.display = 'block';
        }
    }

    function hideAllFields() {
        additionalFields.style.display = 'none';
        iconSourceContainer.style.display = 'none';
        noteField.style.display = 'none';
        introField.style.display = 'none';
        urlField.style.display = 'none';
        phoneNumberField.style.display = 'none';
    }

    function showFields(linkType) {
        hideAllFields();
        switch (linkType) {
            case "website":
            case "email":
            case "other":
            case "location":
                additionalFields.style.display = 'block';
                iconSourceContainer.style.display = 'block';
                document.getElementById('new-link-url').style.display = 'block';
                break;
            case "phone":
            case "whatsapp":
            case "viber":
                additionalFields.style.display = 'block';
                phoneNumberField.style.display = 'block';
                iconSourceContainer.style.display = 'block';
                document.getElementById('new-link-url').style.display = 'none';
                break;
            case "note":
                noteField.style.display = 'block';
                additionalFields.style.display = 'block';
                document.getElementById('new-link-url').style.display = 'none';
              break;
            case "intro":
                introField.style.display = 'block';
                additionalFields.style.display = 'block';
                document.getElementById('new-link-url').style.display = 'none';
              break;
            case "window":
            case "pdf":
            case "payment":
                additionalFields.style.display = 'block';
                document.getElementById('new-link-url').style.display = 'none';
                urlField.style.display = 'block';
                break;
            default:
                break;
        }
    }

    function getTextValue(elementId, maxLength) {
        const value = document.getElementById(elementId).value.trim();
        return value.substring(0, maxLength);
    }

function getRandomColor() {
  // Generate random RGB values
  const r = Math.floor(Math.random() * 256);
  const g = Math.floor(Math.random() * 256);
  const b = Math.floor(Math.random() * 256);
  // Convert RGB to hexadecimal format
  const color = '#' + r.toString(16) + g.toString(16) + b.toString(16);
  return color;
}

function getIconData() {
  const linkType = linkTypeSelect.value;
  const iconSource = iconSourceSelect.value;
  switch (iconSource) {
    case 'default':
      // Return default icon URLs based on link type
      switch (linkType) {
        case 'website':
        case 'other':
          return 'https://fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/open_in_new/default/48px.svg';
        case 'email':
          return 'https://fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/mail/default/48px.svg';
        case 'phone':
        case 'whatsapp':
        case 'viber':
          return 'https://fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/call/default/48px.svg';
        case 'location':
          return 'https://fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/location_on/default/48px.svg';
        case 'file':
          return 'https://fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/folder/default/48px.svg';
        case 'window':
          return 'https://fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/web_asset/default/48px.svg';
        case 'pdf':
          return 'https://fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/picture_as_pdf/default/48px.svg';
        case 'note':
        case 'intro':
          return 'https://fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/note/default/48px.svg';
        default:
          // Generate a random color and apply it to the material icon
          const randomColor = getRandomColor();
          return `<span class="material-icons md-random" style="color: ${randomColor}">random_icon</span>`;
      }
    case 'favicon':
      let url = document.getElementById('new-link-url').value.trim();
      if (!/^https?:\/\//.test(url)) {
        url = 'https://' + url;
      }
      const hostname = new URL(url).hostname;
      return `https://www.google.com/s2/favicons?domain=${hostname}&sz=32`;
    case 'link':
      return document.getElementById('new-icon-url').value.trim();
    case 'file':
      const file = document.getElementById('new-link-icon').files[0];
      if (file) {
        // Construct file URL in the form file://{absolute file path}
        return `file://${file.path}`;
      } else {
        return ''; // No file selected
      }
    default:
      return '';
  }
}
    function stripProtocolFromUrl(url) {
  // Array of prefixes to strip
  const prefixes = [
    'https://', 'http://',  // Web protocols
    'mailto:',             // Email
    'tel:', 'viber://chat?number=', 'whatsapp://send?phone=',  // Phone-related
    'file://',            // Local file
  ];

  // Use a regular expression to match and remove any of the prefixes
  const prefixPattern = new RegExp('^(' + prefixes.map(p => p.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')).join('|') + ')', 'i');
  let strippedUrl = url.replace(prefixPattern, '');

  // Further cleanup for specific types
  if (url.startsWith('mailto:')) {
    return strippedUrl;  // Email is good as is after removing 'mailto:'
  } else if (url.startsWith('tel:') || url.startsWith('viber://') || url.startsWith('whatsapp://')) {
    return strippedUrl.replace(/[?=]/g, '');  // Remove any query parameters
  } else {
    try {
      const { hostname, pathname } = new URL(url);
      return (hostname + pathname).replace(/\/$/, '');
    } catch (e) {
      return strippedUrl;
    }
  }
}

function formatUrl(url, allowCustomProtocol = false) {
  // Check if URL is empty
  if (!url) return '';

  // Remove leading/trailing spaces
  url = url.trim();

  // Remove spaces
  url = url.replace(/\s+/g, '');

  // Lowercase the entire URL
  url = url.toLowerCase();

  // Split URL into parts (protocol, domain, path)
    const urlParts = url.split(/[:.]/);


  // Check if the first part is a protocol (optional)
  let protocol = '';
  if (urlParts[0].match(/^(http|https|ftp)$/)) {
    protocol = urlParts.shift() + ':'; // Extract and remove protocol
  }

  // Remove leading dot from domain (if present)
  urlParts[0] = urlParts[0].replace(/^\./, '');

  // Join the formatted parts back into a URL
  url = protocol + urlParts.join('.');

  // If custom protocols are not allowed, enforce https://
  if (!allowCustomProtocol && !protocol) {
    url = 'https://' + url;
  }

  return url;
}

function validatePdf(url, allowCustomProtocol = false) {
  // Validate URL format using the previous function
  if (!formatUrl(url, allowCustomProtocol)) {
    return false;
  }

  // Check if URL ends with ".pdf" (case-insensitive)
  return url.toLowerCase().endsWith('.pdf');
}

    function validateEmail(email) {
  // Check for blank email
  if (!email || email.trim() === "") {
    errorMessage = "Please enter a valid email address";
    return false;
  }

  // Check for valid email format
  var re = /\S+@\S+\.\S+/;
  return re.test(email);
}
    function validatePhone(phone) {
  // Check for blank phone number
  if (!phone || phone.trim() === "") {
    errorMessage = "Please enter a phone number";
    return false;
  }

  // Regular expression for phone number format (allows + sign and numbers)
  const re = /^\+?[0-9]+$/;
  return re.test(phone);
}


function validateUrl(url) {
            var urlregex = new RegExp(
            "^(http|https|ftp)\://([a-zA-Z0-9\.\-]+(\:[a-zA-Z0-9\.&amp;%\$\-]+)*@)*((25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9])\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])|localhost|([a-zA-Z0-9\-]+\.)*[a-zA-Z0-9\-]+\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(\:[0-9]+)*(/($|[a-zA-Z0-9\.\,\?\'\\\+&amp;%\$#\=~_\-]+))*$");
            return urlregex.test(url);
        }

function validatePUrl(url) {

  // PayPal.me link pattern: paypal.me/username
   const paypalRegex = /^(?:https?:\/\/)?paypal\.me\/(?:[a-zA-Z0-9._-]{1,50}|\{[a-zA-Z0-9._-]{1,50}\})$/i;

  const regex = new RegExp(/^(?:bitcoin:)?(bc1|[13])[a-km-zA-HJ-NP-Z1-9]{25,34}$/i);
  

  if (paypalRegex.test(url)) {
    return true; 
  }
  if (regex.test(url) == true) {
        return true;
    }
    else {
        return false;
    }
}

function validateLoc(locUrl) {
  // Check for empty or blank string
  if (!locUrl || locUrl.trim() === "") {
    errorMessage = "Please enter a location";
    alert(errorMessage);
    return; // Exit the function early
  }

  // Regular expressions for different location formats
  const urlRegex = /^(?:https?:\/\/)?(?:www\.)?(?:maps\.|openstreetmap\.)(?:\w+\/?)+.*$/i; // Case-insensitive


  const geoRegex = /^geo:[-+]?\d+\.\d+,\s*[-+]?\d+\.\d+$/;

  // Check for URL starting with maps, https://maps, https://openstreetmap, or openstreetmap
  if (urlRegex.test(locUrl)) {
    return locUrl; // Valid URL, no need for alert
  }

  // Check for geo: followed by valid coordinates
  if (geoRegex.test(locUrl)) {
    return locUrl; // Valid geo:, no need for alert
  }

  // All checks failed, display alert for invalid format
  errorMessage = "Invalid location format. Only links starting with 'geo:', 'maps.', or 'openstreetmap.' are allowed.";
  alert(errorMessage);
}


function transformGeo(locUrl) {
  // Check for empty or blank string
  if (!locUrl || locUrl.trim() === "") {
    return locUrl; // Indicate no transformation possible
  }
  // Replace a single space between digits with a comma
  const cleanLocUrl = locUrl.replace(/(\d)( )(\d)/, "$1,$3"); // Capture digits, space, digits, replace with $1,$3
  if (locUrl.indexOf(',') !== -1) {
    // Comma exists, just remove the space
    newCleanLocUrl = locUrl.replace(/\s(?=\d)/g, "");
  } else {
    // No comma, replace a single space between digits with a comma
    newCleanLocUrl = locUrl.replace(/(\d)( )(\d)(?!,)/, "$1,$3");
  }



  // Split coordinates using either comma (,) or slash (/) as delimiter
  const coordinates = newCleanLocUrl.split(/[,/]/);

  // Check for valid coordinate format (length 2)
  if (coordinates.length !== 2) {
    return locUrl; // Invalid format if not two parts
  }

  // Validate each coordinate using a simplified regex
  const coordRegex = /^-?\d+\.?\d*$/; // Allows optional decimal
  if (!coordRegex.test(coordinates[0]) || !coordRegex.test(coordinates[1])) {
    return locUrl; // Invalid format if coordinates are not numbers with optional decimal
  }

  // Valid coordinates, return geo: URL
  return `geo:${coordinates.join(',')}`;
}

    function formatPhoneNumber(phone) {
  if (!phone) return '';
  
  // Remove any non-digit characters except '+'
  phone = phone.replace(/[^\d+]/g, '');
  
  // If the number starts with '00', replace it with '+'
  if (phone.startsWith('00')) {
    phone = '+' + phone.substring(2);
  } 
  // Otherwise, if it doesn't start with '+', add '+'
  else if (!phone.startsWith('+')) {
    phone = '+' + phone;
  }
  
  // Remove any 'tel:' prefix if the user added it
  phone = phone.replace(/^tel:/, '');
  
  return phone;
}
// Function to extract video ID from YouTube link
    function getYouTubeId(link) {
      var regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
      var match = link.match(regExp);
      return (match && match[7].length == 11) ? match[7] : null;
    }
    function showError(type, message) {
        const errorElement = type === 'note' || type === 'intro' ? 'note-error' : 'name-error';
        document.getElementById(errorElement).textContent = message;
    }

    function clearError(type) {
        const errorElement = type === 'note' || type === 'intro' ? 'note-error' : 'name-error';
        document.getElementById(errorElement).textContent = '';
    }

    function displayCreatedBookmark(linkData) {
        document.getElementById('created-bookmark').textContent = JSON.stringify(linkData, null, 2);
    }

    function saveBookmark(linkData) {
        let bookmarks = JSON.parse(localStorage.getItem('bookmarks')) || [];
        bookmarks.push(linkData);
        localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
    }
    
    window.cancelAddLink = function() {
     clearForm();
   };

    function clearForm() {
        document.getElementById('new-link-url').value = '';
        document.getElementById('new-link-name').value = '';
        document.getElementById('phone-number').value = '';
        document.getElementById('note-content').value = '';
        document.getElementById('window-url').value = '';
        document.getElementById('icon-source').value = 'default';
        document.getElementById('new-icon-url').value = '';
        document.getElementById('new-link-icon').value = '';
        easyMDE.value('');
        hideAllFields();
        clearError();
    }

    window.addLink = function() {
        const linkType = linkTypeSelect.value;
        console.log(`Adding link of type: ${linkType}`);  // Debug log
        let linkData = [];
        let errorMessage = "";
        let name;

        switch (linkType) {
            case "website":
                const url = formatUrl(document.getElementById('new-link-url').value.trim());
                const isValidUrl = validateUrl(url);
                if (!isValidUrl) {
                  // Display error message
                  alert("Please enter a URL");
                  break;
                }
                name = getTextValue('new-link-name', 30) || stripProtocolFromUrl(url);
                linkData = [linkType, url, name, getIconData(), getRandomColor()];
                break;
            case "email":
                const email = document.getElementById('new-link-url').value.trim();
                const isValidEmail = validateEmail(email);

                if (!isValidEmail) {
                  // Display error message
                  alert("Please enter an email address");
                  break;
                }
                name = getTextValue('new-link-name', 30) || stripProtocolFromUrl(email);
                linkData = [linkType, `mailto:${email}`, name, getIconData(), getRandomColor()];
                break;
            case "phone":
                const phone = formatPhoneNumber(document.getElementById('phone-number').value.trim());
                const isValidPhone = validatePhone(phone);

                if (!isValidPhone) {
                  // Display error message
                  alert("Please enter a phone number");
                  break;
                }              
                name = getTextValue('new-link-name', 30) || phone;  // Use raw number as name
                linkData = [linkType, `tel:${phone}`, name, getIconData(), getRandomColor()];
                break;
            case "whatsapp":
                const waNumber = formatPhoneNumber(document.getElementById('phone-number').value.trim());
                const isValidWA = validatePhone(waNumber);

                if (!isValidWA) {
                  // Display error message
                  alert("Please enter a phone number");
                  break;
                }         
                name = getTextValue('new-link-name', 30) || waNumber;  // Use raw number as name
                wasNumber = waNumber.replace(/^\+/, '');  // Remove '+' for WhatsApp
                linkData = [linkType, `https://wa.me/${wasNumber}`, name, getIconData(), getRandomColor()];
                break;
            case "viber":
                const viberNumber = formatPhoneNumber(document.getElementById('phone-number').value.trim());
                const isValidVi = validatePhone(waNumber);

                if (!isValidVi) {
                  // Display error message
                  alert("Please enter a phone number");
                  break;
                }            
                name = getTextValue('new-link-name', 30) || viberNumber;  // Use raw number as name
                viberrNumber = viberNumber.replace(/^\+/, '');  // Remove '+' for Viber
                linkData = [linkType, `viber://chat?number=${viberrNumber}`, name, getIconData(), getRandomColor()];
                break;
            case "note":
                const noteContent = document.getElementById('note-content').value.trim();
                if (
  // Check for blank note
  (!noteContent || noteContent.trim() === "") ||

  // Check for note length exceeding 300 characters (optional)
  (noteContent.length > 300) ||

  // Check for at least one non-space character
  !/\S/.test(noteContent)
) {
  // Set error message if any validation fails
  alert("Please enter a note");  // Adjust based on specific validation failures
  // ... (optional: handle specific error messages based on the failing condition)
}
                name = getTextValue('new-link-name', 30) || "Note"; 
                linkData = [linkType, noteContent, name, "https://fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/short_text/default/48px.svg", getRandomColor()];
                break;
        case "intro":
           const introContent = easyMDE.value().trim();
           if (introContent.length > 1000) {
           alert("Intro content exceeds 1000 characters") 
           break;
           }
           if (introContent.length < 2) {
           alert("Intro content is too short") 
           break;
           }
           var converter = new showdown.Converter(),
              text      = introContent,
              html      = converter.makeHtml(text);
           name = getTextValue('new-link-name', 30) || "Post";
           linkData = [linkType, html, name, "https://fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/article/default/48px.svg", getRandomColor()];
           break;
            case "window":
                const winUrl = formatUrl(document.getElementById('window-url').value.trim());
                const isValidIUrl = validateUrl(winUrl);
                if (!isValidIUrl) {
                  // Display error message
                  alert("Please enter a URL");
                  break;
                  }
                if ((winUrl.includes("youtu.be")) ||  (winUrl.includes("youtube.com"))) {
                   ytId = getYouTubeId(winUrl);
                   name = getTextValue('new-link-name', 30) || "YouTube screen";
                   linkData = ["YouTube", ytId, name, "https://fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/youtube/default/48px.svg", getRandomColor()];
                   break;
                }
                else {
                   windowUrl = winUrl;
                   name = getTextValue('new-link-name', 30) || "iFrame";
                   linkData = [linkType, windowUrl, name, "https://fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/youtube_activity/default/48px.svg", getRandomColor()];
                   break;
                }
            case "pdf":
                const pdfUrl = formatUrl(document.getElementById('window-url').value.trim());
                const isValidPdf = validatePdf(pdfUrl);
                if (!isValidPdf) {
                  // Display error message
                  alert("Please enter a URL to a .pdf");
                  break;
                }           
                name = getTextValue('new-link-name', 30) || "pdf";
                linkData = [linkType, pdfUrl, name, "https://fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/picture_as_pdf/default/48px.svg", getRandomColor()];
                break;
            case "payment":
                const payUrl = document.getElementById('window-url').value.trim();
                const isValidPUrl = validatePUrl(payUrl);
                if (!isValidPUrl) {
                  // Display error message
                  alert("Please enter a paypal or bitcoin address");
                  break;
                }
                if (payUrl.startsWith("paypal.me")) {
                  pUrl = "https://" + payUrl;
                }  
                else if (payUrl.startsWith("https://paypal.me")) {
                  pUrl = payUrl;
                }  
                else if (payUrl.startsWith("bitcoin:")) {
                  pUrl = payUrl;
                }  
                else {
                  pUrl = "bitcoin:" + payUrl;
                }
                name = getTextValue('new-link-name', 30) || "Paylink";
                linkData = [linkType, pUrl, name, "https://fonts.gstatic.com/s/i/short-term/release/materialsymbolsoutlined/attach_money/default/48px.svg", getRandomColor()];
                break;    
            case "location":
                const locUrl = transformGeo(document.getElementById('new-link-url').value.trim());
                const isValidLoc = validateLoc(locUrl);
                if (!isValidLoc) {
                  // Display error message
                  alert("Please enter a location link");
                  break;
                }
                name = getTextValue('new-link-name', 30) || "Location";
                linkData = [linkType, locUrl, name, getIconData(), getRandomColor()];
                break;
            case "other":
                const otherUrl = formatUrl(document.getElementById('new-link-url').value.trim(), true);
                if (!otherUrl) alert("Please enter a URL");
                linkData = [linkType, otherUrl, getTextValue('new-link-name', 30), getIconData(), getRandomColor()];
                break;
            default:
                errorMessage = "Please select a link type";
                break;
        }

        if (errorMessage) {
            showError(linkType, errorMessage);
            return [];
        } else {
            clearError(linkType);
            displayCreatedBookmark(linkData);
            saveBookmark(linkData);
            return linkData;
        }
    };

    linkTypeSelect.addEventListener('change', handleLinkTypeChange);
    iconSourceSelect.addEventListener('change', handleIconSourceChange);
});
</script>
<h1 id=\"bnnnjnbnhttpsingr\">bnnnj<a href=\"https://in.gr\">nbn</a></h1>\n<p><img src=\"https://cdn.britannica.com/20/142420-004-DD11BEB5/Hui-Xining-Dongguan-Mosque-Qinghai-China-province.jpg\" alt=\"bv\" /></p>\n<hr />

<div class="container">
  <div id="new-link-form">
    <div class="input-field">
      <select id="link-type">
        <option value="" disabled selected>select bookmark type</option>
        <option value="website">Link to a website or social profile</option>
        <option value="email">Email</option>
        <option value="phone">Phone</option>
        <option value="whatsapp">WhatsApp Chat</option>
        <option value="viber">Viber Chat</option>
        <option value="note">Note</option>
        <option value="intro">Post</option>
        <option value="window">Window (embed a webpage)</option>
        <option value="pdf">PDF document</option>
        <option value="location">Location</option>
        <option value="payment">Paylink</option>
        <option value="other">other (any custom url protocol)</option>
      </select>
    </div>

    <div id="additional-fields" style="display: none;">
      <div class="input-field">
  <input type="url" id="new-link-url" placeholder="Enter bookmark target (url or email)">
  <button id="u-clear-btn" class="clear-btn" style="display:none;">✕</button>
</div>
      <div class="input-field">
        <input type="text" id="new-link-name" placeholder="Enter bookmark title (max 30 characters)" maxlength="30">
        <button id="t-clear-btn" class="clear-btn" style="display:none;">✕</button>
        <span class="error" id="name-error"></span>
      </div>
      <div class="input-field icon-source-selector" id="icon-source-container" style="display: none;">
        <select id="icon-source">
          <option value="default">Use default Material Icon (random color)</option>
          <option value="favicon">Use website favicon</option>
          <option value="link">Add icon URL</option>
          <option value="file">Add my own icon</option>
        </select>
        <input type="text" id="new-icon-url" placeholder="Add icon URL" style="display: none;">
        <input type="text" id="new-link-icon" style="display: none;">
      </div>
    </div>
    <div id="note-field" class="input-field" style="display: none;">
  <textarea id="note-content" style="height: 300px; width: 100%;" placeholder="Enter note content (max 300 characters)" maxlength="300"></textarea>
  <span class="error" id="note-error"></span>
</div>
    <div id="intro-field" class="input-field" style="height:300px; overflow-y:scroll; border:1px solid #c0c0c0; display:none;">
    <textarea id="intro-content" style="height:100%" placeholder="Enter note content (max 300 characters)" maxlength="300"></textarea>
<span class="error" id="note-error"></span>
    </div>
<script>
const easyMDE = new EasyMDE({element: document.getElementById('intro-content')});

</script>
      
      

    <div id="url-field" class="input-field" style="display: none;">
      <input type="url" id="window-url" placeholder="Enter URL to display">
      <span class="error" id="url-error"></span>
    </div>

    <div id="phone-number-field" class="input-field" style="display: none;">
      <input type="tel" id="phone-number" placeholder="Add number with country code">
      <span class="error" id="phone-error"></span>
    </div>

    <div class="button-container">
      <button class="add" onclick="addLink()">
        <i class="material-icons">add_circle</i>
      </button>
      <button class="cancel" onclick="cancelAddLink()">
        <i class="material-icons">cancel</i>
      </button>
    </div>
    <pre id="created-bookmark"></pre>
  </div>

  <div id="link-container" class="link-container"></div>
</div>



</body>
</html>
